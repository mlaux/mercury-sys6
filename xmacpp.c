#include <MacTCP.h>#include <Limits.h>#include <MacTypes.h>#include <Resources.h>#include <QuickDraw.h>#include <Fonts.h>#include <Events.h>#include <Windows.h>#include <TextEdit.h>#include <Dialogs.h>#include <Menus.h>#include <Devices.h>#include <ToolUtils.h>#include <MacMemory.h>#include <Files.h>#include <OSUtils.h>#include <DiskInit.h>#include <Traps.h>#include <stdio.h>#include <stdlib.h>#include "tcp.h"// No longer defined in the libraryQDGlobals qd;WindowPtr gMainWindow;void toolbox_init(void){	InitGraf(&qd.thePort);	InitFonts();	InitWindows();	InitMenus();	TEInit();	InitDialogs(NULL);	InitCursor();}void log(const char *fmt, ...){	static short y = 20;		va_list list;    Str255 message;        va_start(list, fmt);    message[0] = vsprintf((char *) &message[1], fmt, list);    va_end(list);		DrawString(message);	y += 10;	MoveTo(20, y);}StreamPtr connect(const char *host, const unsigned short port){	StreamPtr stream;	ip_addr ip;	OSErr err;		ip = dns_lookup(host);	if(ip == 0) {		log("ip lookup failed");		return 0;	}	log("matthewlaux.com ip %s", dns_format_ip(ip));	stream = tcp_create_stream();	if(stream == 0) {		log("stream failed");		return 0;	}	err = tcp_connect(stream, ip, port);	if(err != noErr) {		log("connect failed %d", err);	}	return stream;}#define POLL_BUF_LEN 128void netpoll(StreamPtr stream){	char buf[POLL_BUF_LEN];	OSErr err;	unsigned short len;		while(tcp_available(stream) != 0) {		len = POLL_BUF_LEN - 1;		err = tcp_read(stream, buf, &len);		if(err != noErr) {			log("read error %d", err);			return;		}		buf[len] = 0;		if(len == 0) {			break;		}		log(buf);	}}int main(void){	Rect wind_bounds;	EventRecord event;	Boolean gotEvent;	StreamPtr stream;	const char *str;	OSErr err;		str = "GET / HTTP/1.1\r\nHost: www.matthewlaux.com\r\n\r\n";		toolbox_init();	tcp_init();	dns_init(NULL);		wind_bounds.top = 80;	wind_bounds.left = 80;	wind_bounds.bottom = 380;	wind_bounds.right = 580;		gMainWindow = NewWindow(NULL, &wind_bounds, "\pXMacPP", true, documentProc, (WindowPtr) -1, false, 0);	SetPort(gMainWindow);	MoveTo(20, 20);	TextSize(9);		stream = connect("www.matthewlaux.com", 80);	err = tcp_write(stream, str, strlen(str));		while(1) {		gotEvent = WaitNextEvent(everyEvent, &event, LONG_MAX, NULL);		if(gotEvent) {			switch(event.what) {				case mouseDown:					goto exit;					break;				case updateEvt:					BeginUpdate((WindowPtr) event.message);					EndUpdate((WindowPtr) event.message);					break;				case nullEvent:					netpoll(stream);					break;							}		} else {			netpoll(stream);		}	}	exit:		tcp_release_stream(stream);	tcp_cleanup();	dns_cleanup();		return 0;}